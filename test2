        # âœ… If NPI returns 0 results, reuse the same "no results -> offer NPI" pattern.
        if not providers:
            # Clear cached payload so it never replays an old grid
            state.pop("npi_results_payload", None)

            # Horizon generates the question (no hardcode)
            sys = (
                "You are a CSR assistant.\n"
                "The NPI registry search returned no results.\n"
                "Ask the user if they would like to try NPI search again.\n"
                "Return ONLY the question text (no JSON, no markdown fences).\n"
                "The question must mention that no record was found for the provided input.\n"
            )
            user = f"No provider record found for: {query}"

            try:
                ai_msg = call_horizon(sys, user).strip()
            except requests.exceptions.ReadTimeout:
                state["ai_response"] = getattr(settings, "TIMEOUT_ERROR_MESSAGE", "Request timed out. Please try again.")
                state["ai_response_type"] = "AURA"
                state["ai_response_code"] = 500
                state["prompt_title"] = ""
                state["prompts"] = []
                state["stage"] = "ERROR"
                return state

            mark_llm(state)

            # Reuse the same UI contract as PCP_NO_RESULTS_OFFER_NPI
            state["ai_response"] = ""
            state["ai_response_type"] = "AURA"
            state["ai_response_code"] = 101
            state["prompt_title"] = ai_msg
            state["prompts"] = ["Yes", "No"]
            state["stage"] = "PCP_NO_RESULTS_OFFER_NPI"

            requested = interrupt({
                "prompt": "",
                "stage": state["stage"],
                "prompt_title": state["prompt_title"],
                "prompts": state["prompts"],
                "ai_response_code": state["ai_response_code"],
                "ai_response_type": state["ai_response_type"],
            })

            state["csr_query"] = str(requested).strip()
            return state
