    if not providers:
        # ✅ Ask "No results -> try NPI?" via Horizon and INTERRUPT
        state["providers_result"] = None
        state["npi_origin"] = "fallback"
        state["npi_target_flow"] = "specialist"

        # Clear any old NPI state
        for k in ("npi_results_payload", "npi_mode", "npi_query", "provider_id_override"):
            state.pop(k, None)

        # Build the question with Horizon (no hardcoded sentence)
        sys = (
            "You are a CSR assistant.\n"
            "The specialist provider search returned no results.\n"
            "Ask the user if they would like to try the NPI Web search instead.\n"
            "Return ONLY the question text (no JSON, no markdown).\n"
            "The question must mention that no record was found for the provided input.\n"
        )
        search_basis = (state.get("specialist_raw_filter_input") or "").strip()
        user = f"No specialist provider record found for: {search_basis}"

        try:
            offer_q = call_horizon(sys, user).strip()
        except requests.exceptions.ReadTimeout:
            state["ai_response"] = getattr(settings, "TIMEOUT_ERROR_MESSAGE", "Request timed out. Please try again.")
            state["ai_response_type"] = "AURA"
            state["ai_response_code"] = 500
            state["prompt_title"] = ""
            state["prompts"] = []
            state["stage"] = "ERROR"
            return state

        mark_llm(state)

        # ✅ IMPORTANT: put the offer question into AIResponse and also into prompt
        state["ai_response"] = offer_q
        state["ai_response_type"] = "AURA"
        state["ai_response_code"] = 101
        state["prompt_title"] = ""
        state["prompts"] = ["Yes", "No"]
        state["stage"] = "SPECIALIST_NO_RESULTS_OFFER_NPI"

        requested = interrupt({
            "prompt": state["ai_response"],   # ✅ do not send empty prompt
            "stage": state["stage"],
            "prompt_title": state["prompt_title"],
            "prompts": state["prompts"],
            "ai_response_code": state["ai_response_code"],
            "ai_response_type": state["ai_response_type"],
        })

        state["csr_query"] = str(requested).strip()
        return state


=============================================================

