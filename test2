requested = interrupt({
    "stage": state["stage"],
    "prompt": state["ai_response"],
    "prompt_title": state["prompt_title"],
    "prompts": state["prompts"],
    "ai_response_code": state["ai_response_code"],
    "ai_response_type": state["ai_response_type"],
})
state["csr_query"] = str(requested).strip()
return state



===========

elif stage_from_node == "ERROR":
    ai_resp_text = prompt or last_state.get("ai_response", "")
    ptitle = interrupt_payload.get("prompt_title") or last_state.get("prompt_title") or ""
    pr = interrupt_payload.get("prompts")
    if pr is None:
        pr = last_state.get("prompts", [])
    code = interrupt_payload.get("ai_response_code") or last_state.get("ai_response_code", 500)
    rtype = interrupt_payload.get("ai_response_type") or last_state.get("ai_response_type", "AURA")

    response_payload = base_response(
        thread_id=req.thread_id,
        stage="ERROR",
        ai_response=ai_resp_text,
        csr_query=req.message or "",
        prompts=pr,
        prompt_title=ptitle,
        ai_response_code=code,
        ai_response_type=rtype,
        call_source=call_source,
    )
    break


