    if not providers:
        # mark that we are entering NPI offer flow from specialist
        state["providers_result"] = None
        state["npi_origin"] = "fallback"
        state["npi_target_flow"] = "specialist"

        # Clear any old NPI state
        for k in ("npi_results_payload", "npi_mode", "npi_query", "provider_id_override"):
            state.pop(k, None)

        # --- IMPORTANT FIX ---
        # Do NOT just set stage+return (UI will replay old specialist filters screen).
        # Instead: generate the offer question and INTERRUPT here so the /chat response is correct.

        sys = (
            "You are a CSR assistant.\n"
            "The specialist provider search returned no results.\n"
            "Ask the user if they would like to try the NPI Web search instead.\n"
            "Return ONLY the question text (no JSON, no markdown).\n"
            "The question must mention that no record was found for the provided input.\n"
        )

        search_basis = (state.get("specialist_raw_filter_input") or "").strip()
        user = f"No specialist provider record found for: {search_basis}"

        try:
            offer_q = call_horizon(sys, user).strip()
        except requests.exceptions.ReadTimeout:
            state["ai_response"] = getattr(settings, "TIMEOUT_ERROR_MESSAGE", "Request timed out. Please try again.")
            state["ai_response_type"] = "AURA"
            state["ai_response_code"] = 500
            state["prompt_title"] = ""
            state["prompts"] = []
            state["stage"] = "ERROR"
            return state

        mark_llm(state)

        yes_no_prompts = getattr(settings, "YES_NO_PROMPTS", None)
        if not isinstance(yes_no_prompts, list) or len(yes_no_prompts) < 2:
            yes_no_prompts = ["Yes", "No"]

        state["ai_response"] = ""                # keep contract like PCP offer: question in prompt_title
        state["ai_response_type"] = "AURA"
        state["ai_response_code"] = 101
        state["prompt_title"] = offer_q
        state["prompts"] = yes_no_prompts
        state["stage"] = "SPECIALIST_NO_RESULTS_OFFER_NPI"

        requested = interrupt({
            "prompt": "",
            "stage": state["stage"],
            "prompt_title": state["prompt_title"],
            "prompts": state["prompts"],
            "ai_response_code": state["ai_response_code"],
            "ai_response_type": state["ai_response_type"],
        })

        state["csr_query"] = str(requested).strip()
        return state


==============================================================


